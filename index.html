<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
  <title>Monikers</title>
  <link rel="stylesheet" media="screen" href="https://raw.github.com/necolas/normalize.css/master/normalize.css">
  <!-- <link rel="stylesheet" href="http://cloud.typography.com/7836072/694904/css/fonts.css"> -->
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">

  <script src="hammer.min.js"></script>

  <style>
    html, body, main {
      height: 100%;
      width: 100%;
    }
    /* apply a natural box layout model to all elements, but allowing components to change */
    html {
      box-sizing: border-box;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }

    body {
      /* best helvetica */
      font-family: "Gotham Rounded A", sans-serif;
      font-weight: 300;
      margin: 0;
      background-color: rgba(157, 173, 182, 0.5);
    }

    #table {
      height: 400px;
      width: 800px;
      background-color: rgba(157, 173, 182, 1);
      overflow: hidden;
      margin-left: -230px;
    }

    .card {
      float: left;
      margin: 10px;
      position: relative;
      padding: 20px;
      /* 6x9 cm */
      width: 240px;
      height: 360px;
      background-color: white;
      border-radius: 10px;
      text-align: center;
      box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
      /*background-image: url(back.jpg);*/
    }

    .card > h1 {
      font-size: 18px;
      margin-top: 26px;
      margin-bottom: 23px;
      font-weight: normal;
      height: 46px;
      line-height: 23px;
    }

    .card > p {
      font-size: 12px;
    }

    .card > .line {
      position: absolute;
      bottom: 100px;
      left: 70px;
      width: 100px;
      border-bottom: 2px dotted gray;
    }

    .card > .genre {
      text-transform: uppercase;
      position: absolute;
      bottom: 70px;
      left: 20px;
      width: 200px;
      color: #62A591;
      font-size: 10px;
      letter-spacing: 2px;
    }

    .card > .points {
      position: absolute;
      bottom: 0;
      left: 90px;
      color: white;
      background-color: #62A591;
      width: 60px;
      height: 50px;
      border-top-left-radius: 50%;
      border-top-right-radius: 50%;
      font-size: 20px;
      padding-top: 5px;
    }

    .card > .points > .points-label {
      text-transform: uppercase;
      font-size: 8px;
    }

    .card-transform {
      transform: translateX(-260px);
      transition: 1s ease-in-out;
    }

    .notransition {
      transition-delay: 0s;
      transition-duration: 0s;
    }

    #menu {
      text-align: center;
    }

    #menu > a {
      margin-left: 5px;
    }
  </style>
  <script>
    var cards;
    var currentCard = 0;
    var score = [0,0];
    var currentTeam = 0;
    var teamA = 0;
    var teamB = 1;

    document.addEventListener('DOMContentLoaded', function() {
      // TODO: loading could be optimized
      getCards();

      // setup buttons
      var e = document.getElementById('menu-btn');
      e.addEventListener("click", function() {
        console.log("got to menu");
      });
      var e = document.getElementById('skip-btn');
      e.addEventListener("click", function() {
        skipCard();
      });

      // setup swipe handler
      var myElement = document.getElementById('table');
      var hammertime = new Hammer(myElement);
      //hammertime.get('swipe').set({ direction: Hammer.DIRECTION_ALL });
      hammertime.on('swipe', function(ev) {
          if (ev.direction === Hammer.DIRECTION_LEFT) {
            scoreCard();
          }
      });
      start();
    });

    function getCards() {
      var request = new XMLHttpRequest();
      request.open('GET', '/cards.json', true);
      request.onload = function() {
        if (this.status >= 200 && this.status < 400) {
          cards = JSON.parse(this.response);
          setupCard(1, currentCard);
          setupCard(2, currentCard + 1);
        } else {
          console.log("We reached our target server, but it returned an error");
        }
      };
      request.onerror = function() {
        console.log("There was a connection error of some sort");
      };
      request.send();
    }

    function start() {
      var time = 60;
      var myElement = document.getElementById('timer-btn');
      var v = setInterval(function() {
        time--;
        myElement.innerHTML = time + 's';
      }, 1000);
      setTimeout(function(){
        // stop game, next team
        myElement.innerHTML = '0s';
        clearInterval(v);
      }, time * 1000);

    }

    function setupCard(nodeIndex, cardIndex) {
      var card = cards[cardIndex];
      document.querySelector('#card-' + nodeIndex + ' h1').innerHTML = card.Person;
      document.querySelector('#card-' + nodeIndex + ' p').innerHTML = card.Text;
      document.querySelector('#card-' + nodeIndex + ' .genre').innerHTML = card.Genre;
      document.querySelector('#card-' + nodeIndex + ' .points-value').innerHTML = card.Points;

      switch (card.Points) {
        case "1":
          document.querySelector('#card-' + nodeIndex + ' .genre').style.color = "#54b899";
          document.querySelector('#card-' + nodeIndex + ' .points').style.background = "#54b899";
          break;
        case "2":
          document.querySelector('#card-' + nodeIndex + ' .genre').style.color = "#15ace5";
          document.querySelector('#card-' + nodeIndex + ' .points').style.background = "#15ace5";
          break;
        case "3":
          document.querySelector('#card-' + nodeIndex + ' .genre').style.color = "#8f66a5";
          document.querySelector('#card-' + nodeIndex + ' .points').style.background = "#8f66a5";
          break;
        case "4":
          document.querySelector('#card-' + nodeIndex + ' .genre').style.color = "#e84735";
          document.querySelector('#card-' + nodeIndex + ' .points').style.background = "#e84735";
          break;
        default:
          console.log("I didn't know I this exists.")
      }
    }

    function nextCard() {
      currentCard++;
      var f = document.getElementById('card-' + 0);
      var s = document.getElementById('card-' + 1);
      var t = document.getElementById('card-' + 2);
      f.classList.add("card-transform");
      s.classList.add("card-transform");
      t.classList.add("card-transform");
      f.addEventListener('transitionend', function() {
        f.classList.add("notransition");
        s.classList.add("notransition");
        t.classList.add("notransition");
        f.classList.remove("card-transform");
        s.classList.remove("card-transform");
        t.classList.remove("card-transform");
        f.classList.remove("notransition");
        s.classList.remove("notransition");
        t.classList.remove("notransition");
        setupCard(1, currentCard);
        setupCard(2, currentCard+1);
      }, false);
    }

    function scoreCard() {
      score[currentTeam] = score[currentTeam] + 1;
      nextCard();
    }

    function skipCard() {
      nextCard();
    }

  </script>
</head>
<body>
<div id="table">
  <div class="card" id="card-0">
    <h1>Bob Ross</h1>
    <p>
      A painter and TV host, who starred
      in PBS's The Joy of Painting. He
      taught viewers how to paint "fluffy
      white clouds" and "happy little
      trees" using wet on wet painting. He
      supposedly hated his white-guy afro
      and kept it only for marketing
      purposes.
    </p>
    <div class="line"></div>
    <div class="genre">Celebrities</div>
    <div class="points">
      <span class="points-value">2</span>
      <div class="points-label">Point</div>
    </div>
  </div>
  <div class="card" id="card-1">
    <h1>Bob Ross</h1>
    <p>
      A painter and TV host, who starred
      in PBS's The Joy of Painting. He
      taught viewers how to paint "fluffy
      white clouds" and "happy little
      trees" using wet on wet painting. He
      supposedly hated his white-guy afro
      and kept it only for marketing
      purposes.
    </p>
    <div class="line"></div>
    <div class="genre">Celebrities</div>
    <div class="points">
      <span class="points-value">2</span>
      <div class="points-label">Point</div>
    </div>
  </div>
  <div class="card" id="card-2">
    <h1>Bob Ross</h1>
    <p>
      A painter and TV host, who starred
      in PBS's The Joy of Painting. He
      taught viewers how to paint "fluffy
      white clouds" and "happy little
      trees" using wet on wet painting. He
      supposedly hated his white-guy afro
      and kept it only for marketing
      purposes.
    </p>
    <div class="line"></div>
    <div class="genre">Celebrities</div>
    <div class="points">
      <span class="points-value">2</span>
      <div class="points-label">Point</div>
    </div>
  </div>
</div>
<div id="menu">
  <p style="font-size: 12px;">To score card swipe to the right</p>
  <a role="button" class="pure-button" id="menu-btn" href="#">Menu</a>
  <a role="button" class="pure-button pure-button-primary" id="skip-btn" href="#">Skip Card</a>
  <a role="button" class="pure-button" id="timer-btn" href="#">60s</a>

</div>
</body>
</html>
